(function(){
  const track = document.getElementById('track');
  const slides = Array.from(track.children);
  const dotsContainer = document.getElementById('dots');

  let index = 0;
  const total = slides.length;
  let startX = 0, isDragging = false;

  // create dots
  slides.forEach((_,i)=>{
    const d = document.createElement('div');
    d.className='dot' + (i===0?' active':'');
    d.dataset.i = i;
    d.addEventListener('click', ()=>{ goTo(i) });
    dotsContainer.appendChild(d);
  });

  function goTo(i){
    index = (i+total)%total;
    track.style.transform = `translateX(-${index*100}%)`;
    updateDots();
  }
  function updateDots(){
    document.querySelectorAll('.dot').forEach((d,idx)=>{
      d.classList.toggle('active', idx===index);
    });
  }

  // auto play
  let autoplay = setInterval(()=>{ goTo(index+1); }, 5200);

  /* ✅ NEW свайп с учётом ширины контейнера */
  const slideWidth = track.offsetWidth;

  track.addEventListener('touchstart', (e)=>{
    clearInterval(autoplay);
    startX = e.touches[0].clientX;
    isDragging = true;
  }, {passive:true});

  track.addEventListener('touchmove', (e)=>{
    if(!isDragging) return;
    const x = e.touches[0].clientX;
    const diff = x - startX;
    track.style.transform = `translateX(${ -index * slideWidth + diff }px)`;
  }, {passive:true});

  track.addEventListener('touchend', (e)=>{
    isDragging=false;
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;
    const threshold = slideWidth * 0.2;
    if(diff > threshold && index > 0) index--;
    else if(diff < -threshold && index < total-1) index++;
    goTo(index);
    autoplay = setInterval(()=>{ goTo(index+1); }, 5200);
  });

  // keyboard
  window.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowRight') goTo(index+1);
    if(e.key === 'ArrowLeft') goTo(index-1);
  });
})();
